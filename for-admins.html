<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Markdown Editor</title>
  <link rel="stylesheet" href="./css/bulma.css">
  <link rel="stylesheet" href="./css/admin.css">
</head>

<body>
  <div class="betauia-link"><a href="./index.html">BetaUiA</a></div>

  <!-- === Login Form start === -->
  <!-- <div id="loginForm" class="container">
    <div class="columns is-centered">
      <div class="column is-half">
        <h1 class="title">Login</h1>
        <div class="field">
          <label class="label">Username</label>
          <div class="control">
            <input class="input" type="text" id="username" placeholder="Username">
          </div>
        </div>

        <div class="field">
          <label class="label">Password</label>
          <div class="control">
            <input class="input" type="password" id="password" placeholder="Password">
          </div>
        </div>

        <button class="button is-primary" onclick="handleLogin()">Login</button>
      </div>
    </div>
  </div> -->

  <!-- === Login Form end === -->

  <!-- TODO: Fikse lagring -->
  <!-- 
    * Hva jeg skal sende inn: 
    * Tittel
    * From
    * 
    * POST  
  
  -->
  <!-- === Markdown editor start === -->
  <div id="editor" class="container">
    <!-- Dropdown for selecting text -->
    <div class="dropdown is-hoverable">
      <div class="dropdown-trigger">
        <button class="button" aria-haspopup="true" aria-controls="dropdown-menu">
          <span>Select Section</span>
          <span class="icon is-small">
            <i class="fas fa-angle-down" aria-hidden="true"></i>
          </span>
        </button>
      </div>
      <div class="dropdown-menu" id="dropdown-menu" role="menu">
        <div class="dropdown-content" id="dropdown-Section">
          <a href="#" class="dropdown-item" data-section="beta">Beta</a>
          <a href="#" class="dropdown-item" data-section="betadev">BetaDev</a>
          <a href="#" class="dropdown-item" data-section="betasec">BetaSec</a>
          <a href="#" class="dropdown-item" data-section="bedrifter">For Bedrifter</a>
        </div>
      </div>
    </div>
    <!-- Editor Area -->
    <div class="columns equal-heights">
      <!-- Markdown Input -->
      <div class="column is-half">
        <textarea class="textarea" rows="10" id="inputBox" placeholder="Enter Markdown text..."
          oninput="updateOutput()"></textarea>
        <button class="button is-primary" id="saveButton" onclick="saveEdits()">Save</button>
      </div>

      <!-- Markdown Output -->
      <div class="column is-half">
        <h1 class="is-beta-white">Output:</h1>
        <div id="output" class="content"></div>
      </div>
    </div>
  </div>
  <!-- === Markdown editor end === -->

  <script>



    let currentSection = getElementById("dropdown-Section").section; // Selected section

    async function saveMarkdownContent() {
      const markdownContent = document.getElementById('inputBox').value;

      if (!currentSection) {
        alert('Select a section before saving!');
        return;
      }

      const saveUrl = `/api/saveMarkdown/${currentSection}`; // spÃ¸r backend om riktig path

      try {
        const rawResponse = await fetch(saveUrl, {
          method: 'POST',
          headers: {
            'Accept': 'application/json',
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ content: markdownContent })
        });

        const data = await rawResponse.json();

        if (data.success) {
          alert('Changes saved successfully!');
        } else {
          alert('Error occurred. Try again later or contact admin');
        }
      } catch (error) {
        console.log('Error saving changes.', error);
        alert('Error.');
      }
    }

    // Binding the function to a button click event:
    document.getElementById('saveButton').addEventListener('click', saveMarkdownContent);


    // Modify the existing event listener in your code to update the currentSection variable
    dropdownItems.forEach(item => {
      item.addEventListener("click", function (event) {
        event.preventDefault();
        currentSection = event.target.innerText; // update the current section
        fetchMarkdownContent(currentSection);
      });
    });




  </script>


  <script src="./js/admin.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/3.0.0/marked.min.js"></script>
  <script src="https://use.fontawesome.com/releases/v5.15.1/js/all.js"></script>
</body>

</html>